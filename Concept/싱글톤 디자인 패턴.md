# 디자인 패턴 싱글톤
애플리케이션에서 인스턴스를 단 하나만 생성하도록 보장하는 패턴

### 싱글톤을 사용하는 이유
공통 설정, 로그, 커넥션 등 여러 객체가 동시에 접근해야 하지만
인스턴스는 하나만 있어야 하는 경우에 사용

### 싱글톤 장단점
- 장점
	* 인스턴스 1개 보장
	* 메모리 절약
	* 전역 접근 가능
- 단점
	* 테스트 어려움
	* 전역 상태 문제
	* 결합도 증가

### 싱글톤 조건 3가지
1. 생성자가 private (외부에서 new 못 하게 막음)
2. 자기 자신 타입의 static 인스턴스 보유
3. static 메서드로 인스턴스 제공(getInstance)

만약 생성자가 public이었다면
Singleton s1 = new Singleton();
Singleton s2 = new Singleton();

이런 코드가 가능해져서 싱글톤 의미가 깨짐

=> "싱글톤은 생성자를 private로 막는다"

### Java 싱글톤 (클래식)
public class Singleton {

    // 1. 자기 자신 타입의 static 변수
    private static Singleton instance;

    // 2. 생성자를 private으로 막음
    private Singleton() {}

    // 3. 인스턴스를 반환하는 static 메서드
    public static Singleton getInstance() {
        if (instance == null) { // 동시에 두 스레드가 접근하면 인스턴스가 2개 생성될 가능성이 있음(멀티 스레드 환경에서 싱글톤이 깨짐)
            instance = new Singleton();
        }
        return instance;
    }
}

1. static 변수로 인스턴스 보관
- 클래스당 하나만 존재
- 모든 곳에서 같은 인스턴스 공유

2. 생성자가 private
- 외부에서 new Singleton() 불가능
- 객체 생성을 클래스 내부에서만 통제

3. static 메서드로 인스턴스 제공
- 객체 없이 접근 가능
- 최초 호출 시에만 생성


### 코드 검증
public class Main {
    public static void main(String[] args) {
        Singleton s1 = Singleton.getInstance();
        Singleton s2 = Singleton.getInstance();

        System.out.println(s1 == s2); // true
    }
}

* 싱글톤으로 객체가 생성되었다면 비교 연산에서 동등하게 나와야 한다.

위 구현은 기본적인 싱글톤이지만 멀티스레드 환경에서는 동시에 인스턴스가 생성될 수 있는 문제가 있음

실무에서는 synchronized 처리나
static inner class 방식, enum 싱글톤을 사용해
thread-safe 하게 구현

* 싱글톤 클래스 생성할 때 기억할 포인트
1. private 생성자
2. static 인스턴스
3. getInstance()




### enum 싱글톤
public enum Singleton {
    INSTANCE;

    public void doSomething() {
        System.out.println("Hello Singleton");
    }
}

* 사용 예시
Singleton s1 = Singleton.INSTANCE;
Singleton s2 = Singleton.INSTANCE;


장점
- JVM 이 단 하나만 생성 보장
- thread-safe
- 리플렉션 공격 불가
- 직렬화 문제 해결

단점
- Lazy loading 불가
- 상속 불가

### Spring 싱글톤
@Service
public class UserService {}

@Autowired UserService userService;

* new, getInstance() 사용 X
* 컨테이너가 생성 & 관리

* Spring의 싱글톤(Bean)은 컨테이너 스코프 개념
* Spring은 컨테이너 안에서 인스턴스 개수를 보장하기 때문에  thread-safe

클래식 싱글톤은
인스턴스 생성 시점에 동기화가 없어
멀티스레드 환경에서
여러 인스턴스가 생성될 수 있습니다.

반면 Spring 싱글톤은
컨테이너가 애플리케이션 시작 시
단일 인스턴스를 생성해 관리하며,
개발자는 상태를 가지지 않도록 설계해
동시성 문제를 해결합니다.